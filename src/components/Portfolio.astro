---
import verflix1 from '../img/verflix1.webp';
import imgpro from '../img/imgpro.webp';
import elementor from '../img/elementor.webp';

const projects = [
  {
    id: "01",
    title: "VerFlix",
    category: "Web App / API",
    image: verflix1.src,
    description: "Plataforma de streaming cinematic con integración de TMDB API. Diseño moderno y experiencia de usuario fluida.",
    slug: "verflix",
    bgColor: "#031605"
  },
  {
    id: "02",
    title: "ImgPros",
    category: "Web Tool / React",
    image: imgpro.src,
    description: "Optimización y edición masiva de imágenes directamente en el navegador. Herramienta potente y rápida.",
    slug: "imgpros",
    bgColor: "#031605"
  },
  {
    id: "03",
    title: "ElementorIA",
    category: "Workflow Tool / Extension",
    image: elementor.src,
    description: "Extensión para mejorar el flujo de maquetación responsive en Elementor. Productividad mejorada.",
    slug: "elementoria",
    bgColor: "#031605"
  }
];
---

<!-- Portfolio Section Header -->
<section class="py-16 md:py-24 bg-[#031605] relative">
  <div class="max-w-7xl mx-auto px-6">
    <div class="flex flex-col md:flex-row justify-between items-end mb-8 gap-8">
      <div>
        <span class="text-lime text-sm font-bold tracking-[0.2em] uppercase block mb-4">Portafolio</span>
        <h2 class="text-4xl md:text-5xl font-light tracking-tight uppercase text-[#E8E4DC]">
          Proyectos que <br />
          <span class="text-[rgba(224,204,250,1)] italic font-light">hablan por sí solos.</span>
        </h2>
      </div>
    </div>
  </div>
</section>

<!-- Stacking Cards Section -->
<div id="portfolio-stack-container" class="relative bg-[#031605]">
  {projects.map((project, index) => {
    const isLast = index === projects.length - 1;
    return (
      <section 
        class={`${isLast ? 'last-pinned' : 'pinned'} relative min-h-screen flex items-center justify-center border-t border-x border-[rgba(224,204,250,0.3)] rounded-t-[3rem] md:rounded-t-[5rem] overflow-hidden shadow-[0_-20px_60px_rgba(0,0,0,0.7)]`}
        style={`background: ${project.bgColor}; box-shadow: 0 -20px 60px rgba(0,0,0,0.8), inset 0 1px 0 rgba(224,204,250,0.5);`}
      >
        <div class="myeffect w-full h-full flex items-center">
          <div class="max-w-7xl mx-auto px-6 py-20 w-full">
            <div class="grid md:grid-cols-2 gap-12 items-center">
              
              <!-- Left: Project Info -->
              <div class="space-y-6">
                <div class="flex items-center gap-4">
                  <span class="text-[rgba(224,204,250,0.1)] text-7xl md:text-9xl font-bold">{project.id}</span>
                  <div class="h-px w-20 bg-lime/30"></div>
                  <span class="text-lime text-xs font-bold uppercase tracking-widest border border-lime/30 px-3 py-1 rounded-full">{project.category}</span>
                </div>
                
                <h3 class="text-5xl md:text-8xl font-light tracking-tighter uppercase text-white drop-shadow-lg">
                  {project.title}
                </h3>
                
                <p class="text-[#E8E4DC]/80 text-lg leading-relaxed font-light max-w-lg border-l-2 border-[rgba(224,204,250,0.2)] pl-6">
                  {project.description}
                </p>
                
                <div class="flex flex-wrap gap-4 pt-8">
                  <a 
                    href={`/portfolio/${project.slug}`}
                    class="inline-flex items-center gap-3 px-8 py-4 rounded-full bg-lime text-[#1A2820] font-bold hover:bg-[#E0CCFA] hover:text-[#120224] transition-all duration-300 group shadow-[0_0_20px_rgba(218,252,105,0.3)] hover:shadow-[0_0_30px_rgba(224,204,250,0.5)]"
                  >
                    Ver caso de estudio
                    <svg class="w-5 h-5 group-hover:translate-x-1 transition-transform" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3" />
                    </svg>
                  </a>
                  
                  <a 
                    href="#"
                    class="inline-flex items-center gap-2 px-8 py-4 rounded-full border border-[rgba(224,204,250,0.3)] text-[rgba(224,204,250,1)] font-light hover:bg-[rgba(224,204,250,0.1)] transition-all"
                  >
                    Live Demo
                  </a>
                </div>
              </div>
              
              <!-- Right: Project Image -->
              <div class="relative group">
                <div class="aspect-[4/5] md:aspect-[5/6] rounded-[2rem] overflow-hidden shadow-2xl border border-[rgba(224,204,250,0.1)] relative z-10">
                  <img 
                    src={project.image} 
                    alt={project.title}
                    class="w-full h-full object-cover transition-transform duration-1000 group-hover:scale-105"
                  />
                  <!-- Inner overlay/glow inside image container -->
                  <div class="absolute inset-0 bg-gradient-to-t from-[#031605]/90 to-transparent opacity-60"></div>
                </div>
                
                <!-- Decorative Glows -->
                <div class="absolute -top-10 -right-10 w-40 h-40 bg-lime/10 rounded-full blur-[80px] z-0"></div>
                <div class="absolute -bottom-10 -left-10 w-60 h-60 bg-[rgba(224,204,250,0.05)] rounded-full blur-[100px] z-0"></div>
              </div>
              
            </div>
          </div>
        </div>
      </section>
    );
  })}
</div>

<!-- View All Projects Section -->
<section class="py-16 bg-[#031605] relative">
  <div class="max-w-7xl mx-auto px-6 text-center">
    <a href="/portfolio" class="inline-flex items-center gap-2 px-8 py-4 rounded-full border border-[#E8E4DC]/10 bg-[#E8E4DC]/5 text-[#E8E4DC] font-light hover:bg-lime hover:text-[#1A2820] hover:border-lime transition-all group">
      Ver todos los proyectos
      <svg class="w-4 h-4 group-hover:translate-x-1 transition-transform" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3" />
      </svg>
    </a>
  </div>
</section>

<script>
  import { gsap } from 'gsap';
  import { ScrollTrigger } from 'gsap/ScrollTrigger';
  import Lenis from '@studio-freight/lenis';

  gsap.registerPlugin(ScrollTrigger);

  document.addEventListener("DOMContentLoaded", function () {
    
    /* -------------------------------------------------------
      ANIMATIONS NOW ENABLED ON ALL DEVICES INCLUDING MOBILE
    ------------------------------------------------------- */
    
    /* ---------------------------------
       LENIS SMOOTH SCROLL
    ---------------------------------- */
    const lenis = new Lenis({
      smooth: true,
      normalizeWheel: true,
      lerp: 0.07,
    });

    // GSAP scroll bridge
    lenis.on("scroll", ScrollTrigger.update);

    function raf(time) {
      lenis.raf(time);
      requestAnimationFrame(raf);
    }
    requestAnimationFrame(raf);

    /* ---------------------------------
       STACKING ANIMATION
    ---------------------------------- */
    const lastCard = document.querySelector(".last-pinned");
    const sections = gsap.utils.toArray(".pinned");

    sections.forEach((section, index) => {
      if (section === lastCard) return;

      const effect = section.querySelector(".myeffect");
      const nextSection = sections[index + 1] || lastCard;

      const distance = nextSection.offsetTop - section.offsetTop;

      // Pin the section
      ScrollTrigger.create({
        trigger: section,
        start: "top top",
        end: "+=" + distance,
        pin: true,
        pinSpacing: false,
        scrub: true,
      });

      // Alternate rotation
      const rotation = index % 2 === 0 ? -20 : 20;

      // Shrink/rotate section as next section approaches
      gsap.fromTo(
        effect,
        { scale: 1, y: 0 },
        {
          scale: 0.3,
          rotation: rotation,
          y: 400,
          ease: "power1.inOut",
          scrollTrigger: {
            trigger: section,
            start: "top top",
            end: "+=" + distance,
            scrub: true,

            // Hide previous section once transition almost complete
            onUpdate: (self) => {
              section.style.visibility =
                self.progress > 0.9 ? "hidden" : "visible";
            }
          }
        }
      );
    });
  });
</script>

<style>
  /* Ensure smooth transitions */
  .myeffect {
    transform-origin: center center;
    will-change: transform;
  }
  
  .pinned, .last-pinned {
    will-change: transform;
  }
</style>
